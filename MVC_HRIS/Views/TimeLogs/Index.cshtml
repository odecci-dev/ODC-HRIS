  @using Microsoft.AspNetCore.Http;
    @inject IHttpContextAccessor Accessor;
@{
    ViewData["Title"] = "Time Sheet";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string message = "";
    if (ViewData["Message"] != null)
    {
        message = ViewData["Message"].ToString();
    }
}
<div id="dashboard-main-container">
    <div class="title-main-container">
        <div class="content-container">
            <h4 style="font-size: 26px;" class="text-left">  <i class="fa-solid fa-users" style="margin: 10px;"></i> @ViewData["Title"].ToString()</h4>
        </div>
        <div class="top-main-container ">
        </div>
        <div class="main-container bordered">
            <div class="content-filter">
                <div class="sub-content">
                    <div class="mod-form">

                        <div class="input-container">
                            <button class="btn btn-info" id="add-timein" title="Time In">
                                <i class="fa-solid fa-clock"></i> Time In
                            </button>
                            <button class="btn btn-info" id="add-timeout" title="Time Out" >
                                <i class="fa-solid fa-clock"></i> Time Out
                            </button>
                        </div>
                    </div>
                    <div class="mod-form-2">
                    </div>
                </div>
            </div>
            <div class="content-filter-tbl">
                <table id="time-table" class="table table-bordered table-hover w-100">
                    <thead>
                    </thead>
                    <tbody>
                    </tbody>

                </table>
                <div id="table-footer">
                </div>

            </div>
        </div>

    </div>
@section Scripts {
<script>
            $(document).ready(function () {
                $("#add-timeout").prop("disabled", true);
                $("#add-timein").prop("disabled", true);
                const data = { UserId: @Accessor.HttpContext.Session.GetString("Id")};
                $.ajax({
                    url: '/TimeLogs/GetLastTimeIn',
                    data: {data},
                    type: "POST",
                    datatype: "json"
                }).done(function (data) { // @* //  *@
                    console.log(data);
                    if (data.status == 'true') {
                        $("#add-timeout").prop("disabled", false);
                        $("#add-timein").prop("disabled", true);
                    }
                    else
                    {
                        $("#add-timeout").prop("disabled", true);
                        $("#add-timein").prop("disabled", false);
                    }
                });


            });

            const data = { Usertype: '', UserId: @Accessor.HttpContext.Session.GetString("Id") };
            var img = "/img/OPTION.webp";
            var dtProperties = {
                ajax: {

                    url: '/TimeLogs/GetTimelogsList',
                    data: { data },
                    dataType: "json",       
                    type: "POST",
                    processing: true,
                    serverSide: true,

                    error: function (err) {
                        alert(err.responseText);
                    }
                },
                "columns": [

                    {
                        "title": "Profile",
                        "data": "id",
                        "render": function (data, type, row) {
                            var images = row['filePath'] == null ? img : row['filePath'];
                            let btnView = `

                                            <div class="data-img"> <img src='${images}' width="100%" /> </div>
                               
                                 `
                            return btnView;
                        }
                    },

                    {
                        "title": "Employee ID #",
                        "data": "employeeID"
                    },
                    {
                        "title": "Username",
                        "data": "username"
                    },
                    {
                        "title": "Task",
                        "data": "task"
                    },
                    {
                        "title": "Time In",
                        "data": "timeIn"
                    },
                    {
                        "title": "Time Out",
                        "data": "timeOut"
                    },
                    {
                        "title": "Total Rendered Hours",
                        "data": "renderedHours"
                    }
                ]
            }
            var _tbl = $('#time-table').DataTable(dtProperties);

            $('#add-timein').on('click', function (event) {
                event.preventDefault();
                loadModal('/TimeLogs/TaskModal', '#defaultmodal', '<i class="fa-solid fa-business-time"></i> Time In', 'l', false)
            });
            $('#add-timeout').on('click', function (event) {

                var data = {
                    userid: @Accessor.HttpContext.Session.GetString("Id")

                };
                $.ajax({
                    url: '/TimeLogs/TimeOut',
                    data: {
                        data: data,
                    },
                    type: "POST",
                    datatype: "json"
                }).done(function (data) {
                    console.log(data);
                    if (data.status == '200') {

                        notifyMsg('Success!', 'Successfully Saved', 'green', 'fas fa-check');
                        window.location.href = '@Url.Action("Index", "Timelogs")';
                    }
                    else {
                        notifyMsg('Warning!', data.status, 'red', 'fas fa-exclamation-triangle');
                    }

                });
            });

</script>
}
